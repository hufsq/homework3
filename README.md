# 1 ç‰¹å¾é€‰æ‹©å‚æ•°åŒ–åˆ‡æ¢
classifier = EmailClassifier(feature_method='tfidf')  # å¯åˆ‡æ¢ä¸º'freq'
def _build_features(self):
    if self.feature_method == 'freq':
        # é«˜é¢‘è¯ç‰¹å¾çŸ©é˜µ 100ç»´
    else:
        # TF-IDFç‰¹å¾çŸ©é˜µ 100ç»´
âœ… å®ç°ä¸¤ç§ç‰¹å¾æ¨¡å¼
âœ… ç»Ÿä¸€ç‰¹å¾ç»´åº¦ï¼ˆmax_features=100ï¼‰
âœ… æ”¯æŒè¿è¡Œæ—¶åŠ¨æ€åˆ‡æ¢

# 2 æ ·æœ¬å¹³è¡¡å¤„ç†
if self.balance:
    X, y = SMOTE().fit_resample(X, y)  # æ•°æ®åˆ†å¸ƒå˜ä¸º127:127
âœ… è§£å†³ç±»åˆ«ä¸å¹³è¡¡é—®é¢˜
âœ… é€šè¿‡balanceå‚æ•°æ§åˆ¶

# 3 æ¨¡å‹è¯„ä¼°æŒ‡æ ‡
print(classification_report(y, preds, 
    target_names=['æ™®é€šé‚®ä»¶','åƒåœ¾é‚®ä»¶'], digits=4))
âœ… è¾“å‡ºç²¾åº¦/å¬å›ç‡/F1å€¼
âœ… åŒ…å«è¯¦ç»†ç±»åˆ«æŒ‡æ ‡

# é‚®ä»¶åˆ†ç±»ç³»ç»Ÿ
##  æ ¸å¿ƒåŠŸèƒ½
åŸºäºæœ´ç´ è´å¶æ–¯çš„äºŒåˆ†ç±»ç³»ç»Ÿï¼Œæ”¯æŒä»¥ä¸‹ç‰¹æ€§ï¼š
- åŒç‰¹å¾æ¨¡å¼ï¼šé«˜é¢‘è¯ç»Ÿè®¡ / TF-IDFåŠ æƒ
- æ ·æœ¬å¹³è¡¡å¤„ç†ï¼šSMOTEè¿‡é‡‡æ ·æŠ€æœ¯
- å¤šç»´åº¦è¯„ä¼°ï¼šç²¾åº¦ã€å¬å›ç‡ã€F1å€¼æŠ¥å‘Š

##  ç®—æ³•åŸç†
### å¤šé¡¹å¼æœ´ç´ è´å¶æ–¯
**æ•°å­¦è¡¨è¾¾**ï¼š
```
P(y|xâ‚,...,xâ‚™) âˆ P(y)âˆáµ¢P(xáµ¢|y)
```
**é‚®ä»¶åˆ†ç±»åº”ç”¨**ï¼š
1. è®¡ç®—å…ˆéªŒæ¦‚ç‡ï¼š`P(åƒåœ¾é‚®ä»¶)` å’Œ `P(æ™®é€šé‚®ä»¶)`
2. è®¡ç®—æ¡ä»¶æ¦‚ç‡ï¼š`P(ç‰¹å¾è¯|é‚®ä»¶ç±»å‹)`
3. æ ¹æ®è´å¶æ–¯å®šç†é¢„æµ‹åéªŒæ¦‚ç‡

##  æ•°æ®å¤„ç†æµç¨‹
```python
æµç¨‹å›¾
æ–‡æœ¬è¾“å…¥ â†’ æ­£åˆ™æ¸…æ´— â†’ Jiebaåˆ†è¯ â†’ åœç”¨è¯è¿‡æ»¤ â†’ ç‰¹å¾æ„å»º
```

**å…³é”®å¤„ç†**ï¼š
- æ­£åˆ™æ¸…æ´—ï¼š`re.sub(r'[.ã€ã€‘0-9ã€â€”â€”ã€‚ï¼Œï¼~\*]', '', text)`
- åˆ†è¯å¤„ç†ï¼š`jieba.cut(line)`
- åœç”¨è¯è¿‡æ»¤ï¼š`filter(lambda w: len(w) > 1, words)`

##  ç‰¹å¾å·¥ç¨‹å¯¹æ¯”
| ç‰¹å¾ç±»å‹   | æ•°å­¦è¡¨è¾¾                  | å®ç°å·®å¼‚                 |
|----------|-------------------------|-----------------------|
| é«˜é¢‘è¯ç‰¹å¾ | `count(w_i)`           | åŸºäºè¯é¢‘ç»Ÿè®¡Top100é«˜é¢‘è¯     |
| TF-IDF   | `tf(w_i)*log(N/(1+df))` | ä½¿ç”¨TfidfVectorizerè®¡ç®— |

**é…ç½®å‚æ•°**ï¼š
```python
TfidfVectorizer(
    tokenizer=lambda x: x.split(),  # è‡ªå®šä¹‰åˆ†è¯å™¨
    max_features=100                # ä¸é«˜é¢‘è¯ç‰¹å¾ç»´åº¦ä¸€è‡´
)
```

##  ä½¿ç”¨æŒ‡å—
### åˆå§‹åŒ–é…ç½®
```python
# åˆ›å»ºåˆ†ç±»å™¨ï¼ˆå¯é…ç½®å‚æ•°ï¼‰
classifier = EmailClassifier(
    feature_method='tfidf',  # 'freq'æˆ–'tfidf'
    balance=True              # å¯ç”¨SMOTEå¹³è¡¡
)
```

### è®­ç»ƒä¸é¢„æµ‹
```python
# è®­ç»ƒæ¨¡å‹
train_files = [f'{i}.txt' for i in range(151)]
labels = [1]*127 + [0]*24  # åˆå§‹æ•°æ®åˆ†å¸ƒ
classifier.train(train_files, labels)

# é¢„æµ‹æ–°é‚®ä»¶
classifier.predict('test_mail.txt')
```

## ğŸ“ˆ æ‰©å±•åŠŸèƒ½
### æ ·æœ¬å¹³è¡¡æ•ˆæœ
| å¤„ç†é˜¶æ®µ   | åƒåœ¾é‚®ä»¶ | æ™®é€šé‚®ä»¶ |
|----------|--------|--------|
| åŸå§‹æ•°æ®   | 127    | 24     |
| SMOTEå  | 127    | 127    |

### è¯„ä¼°æŒ‡æ ‡ç¤ºä¾‹
```
              precision    recall  f1-score   support
    æ™®é€šé‚®ä»¶     0.9730    0.9600    0.9665       127
    åƒåœ¾é‚®ä»¶     0.9608    0.9730    0.9669       127
```
# è¿è¡Œç»“æœå±•ç¤º
![å±å¹•æˆªå›¾ 2025-04-01 204021](https://github.com/hufsq/homework3/blob/main/11.jpg)


